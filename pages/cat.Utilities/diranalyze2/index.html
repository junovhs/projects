<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DirAnalyze 2.0</title>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="ui.css">
</head>
<body>
  <header class="row between p-4">
    <div class="row g-2">
      <svg class="logo"><use href="#i-folder"/></svg>
      <div class="col">
        <h1 class="title m-0">DirAnalyze 2.0</h1>
        <p class="muted small m-0">Directory Analysis Tool</p>
      </div>
    </div>
    <div class="row g-2">
      <button id="themeBtn" class="btn icon" title="Toggle theme"><svg id="themeIcon" class="ico"><use href="#i-moon"/></svg></button>
      <button id="clearBtn" class="btn ghost">Clear</button>
    </div>
  </header>

  <div id="app" class="shell">
    <aside id="sidebar" class="col g-3 p-4">
      <div id="sidebarEmpty" class="col center g-3">
        <div class="drop-icon"><svg class="ico"><use href="#i-folder"/></svg></div>
        <h2 class="m-0">Drop Folder Here</h2>
        <p class="muted m-0">Drag & drop a folder or click to select</p>
        <input type="file" id="folderInput" webkitdirectory multiple hidden>
        <button id="selectBtn" class="btn primary">Select Folder</button>
      </div>

      <div id="sidebarControls" style="display:none">
        <div class="row between">
          <button id="textReportBtn" class="btn ghost">Text Report</button>
          <button id="combinedBtn" class="btn ghost">Combined</button>
        </div>
        <div class="row g-2">
          <button id="selectAllBtn" class="btn ghost small">All</button>
          <button id="selectNoneBtn" class="btn ghost small">None</button>
          <button id="expandAllBtn" class="btn ghost small">Expand</button>
          <button id="collapseAllBtn" class="btn ghost small">Collapse</button>
        </div>
        <div class="col g-2">
          <label class="row between small">
            Include patterns
            <input id="includeFilter" class="input" placeholder="e.g., *.js">
          </label>
          <label class="row between small">
            Exclude patterns
            <input id="excludeFilter" class="input" placeholder="e.g., node_modules">
          </label>
          <label class="row between small">
            <input id="showHiddenChk" type="checkbox">
            Show hidden files
          </label>
        </div>
      </div>

      <div class="col g-3">
        <div class="row between">
          <span class="small muted">Directory Structure</span>
          <span id="committedBadge" class="badge">0 committed files</span>
        </div>
        <button id="copyTreeBtn" class="btn ghost w-full" disabled>Copy Report</button>
      </div>

      <div id="tree"></div>
    </aside>

    <div id="divider"></div>

    <main class="main">
      <div id="mainTreePane" class="main-pane">
        <div class="pane-head row between p-3">
          <span class="small muted">Report Preview</span>
          <div class="row g-1">
            <span id="statsRow" class="row g-2" style="display:none">
              <span id="totalFilesBadge" class="badge"></span>
              <span id="selectedFilesBadge" class="badge"></span>
            </span>
          </div>
        </div>
        <div id="emptyState" class="empty col center g-3">
          <div class="empty-icon"><svg><use href="#i-file-text"/></svg></div>
          <h2 id="emptyTitle" class="m-0">No files loaded</h2>
          <p id="emptyDesc" class="muted m-0">Drop a folder to get started with directory analysis</p>
        </div>
        <pre id="treeReport" class="pane-scroll report-pre mono"></pre>
      </div>

      <div id="editorPane" class="editor-pane">
        <div class="pane-head row between p-3">
          <span id="currentFileLabel" class="small"></span>
          <div class="row g-2">
            <button id="copyLinesBtn" class="btn ghost">Copy with Lines</button>
            <button id="patchBtn" class="btn ghost">Apply Patch</button>
            <button id="saveBtn" class="btn primary" disabled>Save</button>
            <button id="closeBtn" class="btn ghost">Close</button>
          </div>
        </div>
        <div id="editorToolbar" class="toolbar row p-2" style="display:none">
          <span class="small muted">Line numbers</span>
        </div>
        <div class="editor">
          <div class="linenums">
            <div id="linenumsInner" class="linenums-inner"></div>
          </div>
          <textarea id="editor" class="textarea" placeholder="Select a file to edit..."></textarea>
        </div>
      </div>
    </main>
  </div>

  <footer id="status" class="status row between px-4 py-3 small">
    <span id="statusFiles">0 files</span>
    <span id="statusSelected">0 selected</span>
    <span id="statusSize">0 B</span>
    <span id="statusMsg">Ready</span>
  </footer>

  <dialog id="patchDialog">
    <div class="dlg-head row between">
      <h3 class="m-0">Apply AI Patches</h3>
      <button class="btn icon" onclick="document.getElementById('patchDialog').close()">Ã—</button>
    </div>
    <div class="dlg-body">
      <p class="small muted">Paste patches with this format:</p>
      <pre class="mono small p-2" style="background:var(--muted); border-radius:6px; margin:.5rem 0">FILE: path/to/file.js
12-14:
  // new code here</pre>
      <textarea id="patchInput" class="dlg-input" placeholder="Paste your patches here..."></textarea>
    </div>
    <div class="row p-3 between">
      <button class="btn ghost">Cancel</button>
      <button id="applyPatchesBtn" class="btn primary">Apply Patches</button>
    </div>
  </dialog>

  <div id="toast" class="toast" style="display:none"></div>

  <script src="report.js"></script>
  <script src="app.js"></script>
</body>
</html>
:root{
  --bg:#f8fafc; --bg2:#eef2ff; --card:#fff; --muted:#f1f5f9;
  --text:#0f172a; --text-muted:#64748b;
  --primary:#1d4ed8; --primary-foreground:#fff;
  --border:#e2e8f0; --ring:#93c5fd;
  --headerH:56px; --footerH:40px;
}
.dark{
  --bg:#0b1220; --bg2:#111827; --card:#0f172a; --muted:#0b1424;
  --text:#e5e7eb; --text-muted:#9ca3af;
  --primary:#60a5fa; --primary-foreground:#0b1220;
  --border:#1f2937; --ring:#3b82f6;
}

*{box-sizing:border-box}
html,body{height:100%; overflow:hidden}
body{
  margin:0;
  font:14px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, Noto Sans;
  color:var(--text);
  background:linear-gradient(135deg,var(--bg),var(--bg2));
}
a{color:inherit}

.small{font-size:12px}
.mono{font:12px/1.6 ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace}

/* utils */
.row{display:flex; align-items:center}
.col{display:flex; flex-direction:column}
.between{justify-content:space-between}
.center{justify-content:center}
.g-2{gap:.5rem} .g-3{gap:.75rem} .g-4{gap:1rem}
.p-4{padding:1rem} .p-6{padding:1.5rem}
.px-4{padding-left:1rem; padding-right:1rem}
.py-3{padding-top:.75rem; padding-bottom:.75rem}
.card{background:var(--card); border:1px solid var(--border); border-radius:14px}
.badge{display:inline-flex; align-items:center; height:22px; padding:0 .6rem; border:1px solid var(--border); background:var(--muted); border-radius:999px; font-size:12px}
.muted{color:var(--text-muted)}
.shadow{box-shadow:0 1px 2px rgba(0,0,0,.06), 0 8px 30px rgba(0,0,0,.05)}
.logo{width:32px; height:32px; border-radius:999px; background:radial-gradient(circle at 30% 20%, #93c5fd, #3b82f6); display:inline-flex; align-items:center; justify-content:center; color:#fff; font-weight:700}

/* buttons/inputs */
.btn{display:inline-flex; align-items:center; gap:.4rem; border:1px solid var(--border); background:var(--card); color:var(--text); border-radius:8px; height:32px; padding:0 .75rem; cursor:pointer}
.btn:hover{background:color-mix(in hsl,var(--card),var(--primary) 5%)}
.btn[disabled]{opacity:.5; cursor:not-allowed}
.btn.primary{background:var(--primary); border-color:var(--primary); color:var(--primary-foreground)}
.btn.ghost{border-color:transparent; background:transparent}
.btn.icon{width:36px; height:36px; justify-content:center}
.input{height:32px; border:1px solid var(--border); background:var(--card); color:var(--text); border-radius:6px; padding:0 .5rem}
.checkbox{width:14px; height:14px}

/* icons */
.ico{width:16px; height:16px}

/* tooltips */
.has-tip{position:relative}
.has-tip::after{
  content:attr(data-tip); position:absolute; bottom:calc(100% + 8px); left:50%; transform:translateX(-50%) translateY(4px);
  background:#111; color:#fff; padding:.35rem .55rem; font-size:12px; border-radius:6px; box-shadow:0 8px 24px rgba(0,0,0,.25);
  white-space:pre; opacity:0; pointer-events:none; transition:opacity .15s, transform .15s;
  z-index:80;
}
.has-tip::before{
  content:""; position:absolute; bottom:100%; left:50%; transform:translateX(-50%) translateY(4px);
  border:6px solid transparent; border-top-color:#111; opacity:0; transition:opacity .15s, transform .15s; z-index:80;
}
.has-tip:hover::after, .has-tip:hover::before{opacity:1; transform:translateX(-50%) translateY(0)}

/* header/footer/layout */
header{position:sticky; top:0; z-index:10; background:color-mix(in hsl,var(--card), transparent 20%); backdrop-filter:saturate(1.2) blur(6px); border-bottom:1px solid var(--border)}
#app{min-height:100vh}
.shell{display:flex; height:calc(100vh - var(--headerH) - var(--footerH))}
.sidebar{position:relative; width:320px; border-right:1px solid var(--border); background:color-mix(in hsl,var(--card), transparent 30%)} 
.main{flex:1; display:flex; flex-direction:column; min-height:0}
.divider{position:absolute; top:0; right:0; bottom:0; width:6px; cursor:ew-resize}
.divider:hover{background:color-mix(in hsl,var(--primary), transparent 50%)}

/* scrollbars */
*{scrollbar-width:thin; scrollbar-color:color-mix(in hsl,var(--text-muted), transparent 50%) transparent; transition:background-color .2s, border-color .2s, color .2s}
::-webkit-scrollbar{width:6px; height:6px}
::-webkit-scrollbar-thumb{background:color-mix(in hsl,var(--text-muted), transparent 50%); border-radius:3px}
::selection{background:var(--primary); color:var(--primary-foreground)}

/* tree */
.tree{height:100%; overflow:auto; padding:.5rem}
.tree-item{display:flex; align-items:center; gap:.5rem; padding:.25rem .5rem; border-radius:6px}
.tree-item:hover{background:color-mix(in hsl,var(--muted), var(--primary) 6%)}
.tree-name{flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.icon-btn{border:0; background:transparent; padding:0; width:20px; height:20px; display:flex; align-items:center; justify-content:center; cursor:pointer; color:var(--text-muted)}
.icon-btn:hover{color:var(--text)}

/* main pane & editor */
.main-pane{height:100%}
.pane-head{border-bottom:1px solid var(--border); background:color-mix(in hsl,var(--muted), transparent 20%)}
.pane-scroll{padding:1rem; height:100%; overflow:auto}
.report-pre{white-space:pre-wrap; display:none}
.empty{height:100%; text-align:center; color:var(--text-muted)}
.empty-icon{width:96px;height:96px;border-radius:999px;background:color-mix(in hsl,var(--primary), transparent 85%); display:flex;align-items:center;justify-content:center; font-size:42px}
.empty-title{font-size:18px; color:var(--text)}
.drop-icon{width:64px;height:64px;border-radius:999px; background:color-mix(in hsl,var(--primary), transparent 80%); display:flex;align-items:center;justify-content:center}

/* editor */
.editor-pane{display:none; height:100%}
.editor{display:flex; height:100%; min-height:0}
.linenums{
  width:40px; background:color-mix(in hsl,var(--muted), transparent 20%); border-right:1px solid var(--border);
  font:12px/24px ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; color:var(--text-muted);
  padding:.25rem .25rem; overflow:hidden;
}
.linenums-inner{position:relative}
.textarea{
  flex:1; border:0; padding:.5rem .75rem; outline:none; resize:none;
  font:12px/24px ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
  background:transparent; color:var(--text)
}

/* footer pinned */
.status{
  position:fixed; left:0; right:0; bottom:0; z-index:20;
  border-top:1px solid var(--border); background:var(--primary); color:var(--primary-foreground)
}

/* dialog & toast */
dialog{border:1px solid var(--border); background:var(--card); color:var(--text); border-radius:12px; padding:0; width:min(900px, calc(100vw - 2rem))}
dialog::backdrop{background:#0006}
.dlg-head{padding:1rem; border-bottom:1px solid var(--border)}
.dlg-body{padding:1rem}
.dlg-input{height:280px; border:1px solid var(--border); border-radius:8px}
.toast{position:fixed; right:1rem; bottom:1rem; background:#111; color:#fff; border-radius:10px; padding:.75rem 1rem; box-shadow:0 8px 30px rgba(0,0,0,.3); z-index:50}
.title{font-size:16px; font-weight:600}
.toolbar{border-bottom:1px solid var(--border); background:color-mix(in hsl,var(--muted), transparent 20%); display:none}
.w-full{width:100%}
.m-0{margin:0}